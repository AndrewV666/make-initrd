#!/bin/udevsh --stdin

. /dev/.initramfs/env
. /scripts/functions

devluks=
nameluks=
password=
add() {
	cryptsetup isLuks "$DEVNAME" || return 0

	[ -n "$LUKSDEV" ] || LUKSDEV="$DEVNAME"
	get_dev devluks "$LUKSDEV" || return 0

	nameluks="${devluks##*/}-luks"

	cryptsetup --key-file=- luksOpen "$devluks" "$nameluks"
	retcode="$?"

	if [ "$retcode" != "0" ]; then
		lock_udev "Unable activate LUKS: $retcode"
		return
	fi
}

add
