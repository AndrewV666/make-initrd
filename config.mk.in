VERSION		 = @VERSION@
# System paths
WORKDIR_SUFFIX	?= work
WORKDIR		?= @WORKDIR@/initrd-$(KERNEL).$(WORKDIR_SUFFIX)
ROOTDIR		?= $(WORKDIR)/root

TOOLSDIR	 = @PREFIX@/tools
DATADIR		?= @PREFIX@/data
SCRIPTDIR	?= @PREFIX@/scripts.d
FEATURESDIR	?= @PREFIX@/features
SYSCONFDIR	?= /etc
SYSFS_PATH	?= /sys

PATH		= $(TOOLSDIR):$(shell echo $$PATH)

MAKE_INITRD_BIN		= @SBINDIR@/make-initrd

# Config file locations
INITRD_CONFIG		?=
INITRD_CONFIG_LIST	 = $(wildcard $(SYSCONFDIR)/initrd.mk $(SYSCONFDIR)/initrd.mk.d/*.mk)

# Guess variables
GUESS_DEVICE_SCRIPTS	= $(wildcard $(FEATURESDIR)/*/guess/device)
GUESS_COMMON_SCRIPTS	= $(wildcard $(FEATURESDIR)/*/guess/common)

# Guess targets configuration
RESOLVE_MODALIAS	?= 1

# Helpers
GEN_INIT_CPIO		= @BINDIR@/gen_init_cpio
CREATE_INITRD		= $(TOOLSDIR)/create-initrd
PACK_IMAGE		= $(TOOLSDIR)/pack-image
ADD_MODULE		= $(TOOLSDIR)/add-module
LOAD_MODULE		= $(TOOLSDIR)/load-module
ADD_RESCUE_MODULES	= $(TOOLSDIR)/add-rescue-modules
PUT_FILE		= $(TOOLSDIR)/put-file
PUT_TREE		= $(TOOLSDIR)/put-tree


# User defaults
FEATURES	?=
KERNEL		?= $(shell uname -r)
IMAGE_SUFFIX	?=
IMAGEFILE	?= /boot/initrd-$(KERNEL)$(IMAGE_SUFFIX).img

# Global variables
FIRMWARE_DIRS		?= /lib/firmware/updates /lib/firmware /lib/firmware/$(KERNEL)/updates /lib/firmware/$(KERNEL)
VERBOSE			?=
FSTAB			?= /etc/fstab
BLACKLIST_MODULES	?=

# Load extra configs
feature_configs		 = $(realpath $(wildcard $(FEATURESDIR)/*/config.mk))
ifeq "$(feature_configs)" ''
$(error Cannot find configs for feature. Something goes wrong.)
endif
include $(feature_configs)

ifdef VERBOSE
  verbose=-v
  Q=
else
  Q = @
endif

