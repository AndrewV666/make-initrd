#!/bin/udevsh

. /dev/.initramfs/env
. /scripts/functions

devroot=
add() {
	# Do not mount root twice
	[ ! -e /dev/root ] || return 0

	get_dev devroot "$ROOT" || return 0

	local roflag=-w
	[ -z "$readonly" ] || roflag=-r

	local FSTYPE="${ROOTFSTYPE:-$ID_FS_TYPE}"
	# Mount root
	if ! mount "$roflag" -o ${ROOTFLAGS:-defaults} -t "$FSTYPE" "$devroot" "$rootmnt"; then
		lock_udev "Unable to mount $devroot as $FSTYPE."
		return
	fi
	message "Mount '$devroot' as $rootmnt"
	ln -sf "$devroot" /dev/root
}

add
