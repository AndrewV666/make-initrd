VERSION		 = @VERSION@
# System paths
TEMPDIR		?= @TEMPDIR@
WORKDIR_SUFFIX	?= work
WORKDIR		 = $(TEMPDIR)/initrd-$(KERNEL).$(WORKDIR_SUFFIX)
ROOTDIR		 = $(WORKDIR)/root

TOOLSDIR	 = @PREFIX@/tools
DATADIR		?= @PREFIX@/data
SCRIPTDIR	?= @PREFIX@/scripts.d
FEATURESDIR	?= @PREFIX@/features
SYSCONFDIR	?= /etc
SYSFS_PATH	?= /sys

PATH		= $(TOOLSDIR):$(shell echo $$PATH)

MAKE_INITRD_BIN		= @SBINDIR@/make-initrd

# Config file locations
INITRD_CONFIG		?=
INITRD_CONFIG_LIST	 = $(wildcard $(SYSCONFDIR)/initrd.mk $(SYSCONFDIR)/initrd.mk.d/*.mk)

# Guess variables
GUESS_DEVICE_SCRIPTS	= $(wildcard $(FEATURESDIR)/*/guess/device)
GUESS_COMMON_SCRIPTS	= $(wildcard $(FEATURESDIR)/*/guess/common)

# Global variables
RESOLVE_MODALIAS	?= 1
KERNEL			?= $(shell uname -r)

# This user's preferences are make sence only if user's config file is loaded.
ifneq "$(INITRD_CONFIG)" ''

# User defaults
FEATURES		?=
IMAGE_SUFFIX		?=
IMAGEFILE		?= /boot/initrd-$(KERNEL)$(IMAGE_SUFFIX).img

FIRMWARE_DIRS		?= /lib/firmware/updates /lib/firmware /lib/firmware/$(KERNEL)/updates /lib/firmware/$(KERNEL)
VERBOSE			?=
FSTAB			?= /etc/fstab
BLACKLIST_MODULES	?=

endif # INITRD_CONFIG

# Load extra configs
feature_configs		 = $(realpath $(wildcard $(FEATURESDIR)/*/config.mk))
ifeq "$(feature_configs)" ''
$(error Cannot find configs for feature. Something goes wrong.)
endif
include $(feature_configs)

ifdef VERBOSE
  verbose=-v
  Q=
else
  Q = @
endif

