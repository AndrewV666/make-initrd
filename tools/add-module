#!/bin/sh -efu

. sh-functions
. module-functions

. shell-error

ignore_missing=
if [ "${1-}" = '--optional' ]; then
	ignore_missing=1
	shift
fi

for n; do
	if [ -n "${n##*[/\[\].*&^\$\\\\/]*}" ]; then
		n="$(normalize_modname "$n")"
		add_module "$n"

	elif [ -n "${KERNEL_MODULES-}" ]; then
		find "$KERNEL_MODULES" -type f | grep -E -e "$n" |
		while read -r m; do
			add_module "$m"
		done
	else
		fatal "Unable to handle pattern: $n"
	fi
done
